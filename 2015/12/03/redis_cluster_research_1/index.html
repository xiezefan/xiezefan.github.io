<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>Redis Cluster 初探(1) - 集群搭建与扩容 | Zefan Xie's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 6.1.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Redis Cluster 初探(1) - 集群搭建与扩容</h1><a id="logo" href="/.">Zefan Xie's Blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Redis Cluster 初探(1) - 集群搭建与扩容</h1><div class="post-meta">2015-12-03<span> | </span><span class="category"><a href="/categories/technical/">Technical</a></span></div><a class="disqus-comment-count" data-disqus-identifier="2015/12/03/redis_cluster_research_1/" href="/2015/12/03/redis_cluster_research_1/#disqus_thread"></a><div class="post-content"><p>Redis Cluster是Redis官方的集群实现方案，在此之前已经有一些民间的第三方Redis集群解决方案，如Twitter的Twenproxy，豌豆荚的Codis，与其不同的是，Redis Cluster并非使用Porxy的模式来连接集群节点，而是使用无中心节点的模式来组建集群，有一定性能优势也有缺点，本文主要是我调研Redis Cluster的一些知识整理与经验汇总。</p>
<span id="more"></span>

<p>首先我们来尝试下搭建一个Redis Cluster集群</p>
<h4 id="前置准备"><a href="#前置准备" class="headerlink" title="前置准备"></a>前置准备</h4><p>Redis Cluster需要Redis 3.0及以上版本才支持，此文发布的时候，Redis的最高版本为3.0.5。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.redis.io/releases/redis-3.0.5.tar.gz</span><br><span class="line">tar -xvf redis-3.0.5.tar.gz</span><br><span class="line">cd redis-3.0.5</span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<p>编译完Redis，生成的可执行文件在<code>redis-3.0.5/src</code>之中，为了方便使用，我们把可执行文件的目录加入PATH之中。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">增加以下内容</span></span><br><span class="line"></span><br><span class="line">REDIS_HOME=/home/xiezefan/sofeware/redis-3.0.5/src</span><br><span class="line">PATH=$REDIS_HOME:$PATH</span><br><span class="line">export PATH</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">保存后让修改生效</span></span><br><span class="line"></span><br><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>

<p>要创建Redis Cluster，我们还需要安装Ruby以及RubyGems。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install ruby</span><br><span class="line">yum install gcc g++ make automake autoconf curl-devel openssl-devel zlib-devel httpd-devel apr-devel apr-util-devel sqlite-devel</span><br><span class="line">yum install ruby-rdoc ruby-devel</span><br><span class="line">yum install rubygems</span><br><span class="line">gem install redis</span><br></pre></td></tr></table></figure>

<h4 id="创建集群"><a href="#创建集群" class="headerlink" title="创建集群"></a>创建集群</h4><p>此次此时我们需要创建8个节点，端口号7000~7007</p>
<p>复制<code>redis-3.0.5/redis.conf</code>，修改一下内容</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkdir cluster</span><br><span class="line">cp ~/sofeware/redis-3.0.5/redis.conf cluster/</span><br><span class="line">vim cluster/redis.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改以下内容</span></span><br><span class="line">port 7000</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>

<p>批量复制7份，修改配置文件的端口号。修改完毕后，分别进入各个节点的目录中启动redis</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd 7000</span><br><span class="line">redis-server redis.conf</span><br><span class="line"></span><br><span class="line">cd 7001</span><br><span class="line">redis-server redis.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">依次启动7000-7007</span></span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>至此，8个Redis全都启动完毕，但是他们还处于彼此互相不知道彼此的阶段。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xiezefan@ubuntu:~$ ps -ef | grep redis</span><br><span class="line">xiezefan 13372     1  0 20:09 ?        00:00:08 redis-server *:7000 [cluster]</span><br><span class="line">xiezefan 13376     1  0 20:09 ?        00:00:08 redis-server *:7001 [cluster]</span><br><span class="line">xiezefan 13380     1  0 20:09 ?        00:00:08 redis-server *:7002 [cluster]</span><br><span class="line">xiezefan 13382     1  0 20:09 ?        00:00:08 redis-server *:7003 [cluster]</span><br><span class="line">xiezefan 13386     1  0 20:09 ?        00:00:08 redis-server *:7004 [cluster]</span><br><span class="line">xiezefan 13390     1  0 20:09 ?        00:00:08 redis-server *:7005 [cluster]</span><br><span class="line">xiezefan 13394     1  0 20:09 ?        00:00:08 redis-server *:7006 [cluster]</span><br><span class="line">xiezefan 13400     1  0 20:09 ?        00:00:08 redis-server *:7007 [cluster]</span><br></pre></td></tr></table></figure>

<p>下一步，我们要将7000-7005这六个节点连接成一个集群。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-trib.rb create --replicas 1 10.211.55.4:7000 10.211.55.4:7001 10.211.55.4:7002 10.211.55.4:7003 10.211.55.4:7004 10.211.55.4:7005</span><br></pre></td></tr></table></figure>

<p>该命令表示，将7000-7006节点创建一个集群，冗余为1，就是3主3从。切记，此处指定的IP会在client发送move命令的时候返回，所以一定要指定为客户端能访问到的IP，例如下面这种IP是不可行的，client拿到的IP就位是127.0.0.1导致一直重定向失败。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-trib.rb create --replicas 1 127.0.0.1:7000 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005</span><br></pre></td></tr></table></figure>

<p>输入后，redis-trib自动分配给出一个slot的分配方案</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span></span><br><span class="line">Using 3 masters:</span><br><span class="line">10.211.55.4:7000</span><br><span class="line">10.211.55.4:7001</span><br><span class="line">10.211.55.4:7002</span><br><span class="line">Adding replica 10.211.55.4:7003 to 10.211.55.4:7000</span><br><span class="line">Adding replica 10.211.55.4:7004 to 10.211.55.4:7001</span><br><span class="line">Adding replica 10.211.55.4:7005 to 10.211.55.4:7002</span><br><span class="line">M: 9dfef549f7917794cbabaf96781ed0e19957c1f3 10.211.55.4:7000</span><br><span class="line">   slots:0-5460 (5461 slots) master</span><br><span class="line">M: c14485e8d7f1f3ec5c505b41fe727b657c951d8d 10.211.55.4:7001</span><br><span class="line">   slots:5461-10922 (5462 slots) master</span><br><span class="line">M: 8b308093e99f4299b8c18ab1dd81c5a83a3528c6 10.211.55.4:7002</span><br><span class="line">   slots:10923-16383 (5461 slots) master</span><br><span class="line">S: 632409883570eb5cecf6089583fba64a41d1154f 10.211.55.4:7003</span><br><span class="line">   replicates 9dfef549f7917794cbabaf96781ed0e19957c1f3</span><br><span class="line">S: edd31196e2980360b0738c57af95e1a69b0f9c9b 10.211.55.4:7004</span><br><span class="line">   replicates c14485e8d7f1f3ec5c505b41fe727b657c951d8d</span><br><span class="line">S: 95063a99c5cf2cc4abc51ca1e8ff0f3b8d60271c 10.211.55.4:7005</span><br><span class="line">   replicates 8b308093e99f4299b8c18ab1dd81c5a83a3528c6</span><br><span class="line">Can I set the above configuration? (type &#x27;yes&#x27; to accept):</span><br></pre></td></tr></table></figure>
<p>输入yes后，集群自动创建，创建完毕后，通过redis-cli进入任一节点，使用<code>cluster nodes</code>命令可以查看各个节点的状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">xiezefan@ubuntu:~$ redis-cli -p 7000</span><br><span class="line">127.0.0.1:7000&gt;cluster nodes</span><br><span class="line">c14485e8d7f1f3ec5c505b41fe727b657c951d8d 10.211.55.4:7001 master - 0 1449060968280 2 connected 5461-10922</span><br><span class="line">95063a99c5cf2cc4abc51ca1e8ff0f3b8d60271c 10.211.55.4:7005 slave 8b308093e99f4299b8c18ab1dd81c5a83a3528c6 0 1449060968280 6 connected</span><br><span class="line">edd31196e2980360b0738c57af95e1a69b0f9c9b 10.211.55.4:7004 slave c14485e8d7f1f3ec5c505b41fe727b657c951d8d 0 1449060967274 5 connected</span><br><span class="line">8b308093e99f4299b8c18ab1dd81c5a83a3528c6 10.211.55.4:7002 master - 0 1449060966769 3 connected 10923-16383</span><br><span class="line">632409883570eb5cecf6089583fba64a41d1154f 10.211.55.4:7003 slave 9dfef549f7917794cbabaf96781ed0e19957c1f3 0 1449060967274 4 connected</span><br><span class="line">9dfef549f7917794cbabaf96781ed0e19957c1f3 10.211.55.4:7000 myself,master - 0 0 1 connected 0-5460</span><br></pre></td></tr></table></figure>

<p>随便输入一个查询指令<code>get user.1</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:7000&gt; get user.1</span><br><span class="line">(error) MOVED 9645 10.211.55.4:7001</span><br></pre></td></tr></table></figure>
<p>因为user.1所在的solt-9645在7001节点上，cluster给你发送MOVED指令让你去7001节点查找数据，连接redis-cli的时候，使用<code>-c</code>参数可以指定查询时接收到MOVED指令自动跳转</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xiezefan@ubuntu:~$ redis-cli -c -p 7000</span><br><span class="line">127.0.0.1:7000&gt; get user.1</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Redirected to slot [9645] located at 10.211.55.4:7001</span></span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>

<h4 id="集群扩容"><a href="#集群扩容" class="headerlink" title="集群扩容"></a>集群扩容</h4><p>现在我们已经有一个包含6个节点的集群，我写了段<a target="_blank" rel="noopener" href="https://gist.github.com/xiezefan/4bd5e0d0c264aadaf061">代码</a>，往集群写入10W条测试数据。<br>现在模拟机器扩容场景，为集群加入一个master节点7006和一个slave节点7007。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-trib.rb add-node 10.211.55.4:7006 10.211.55.4:7000</span><br></pre></td></tr></table></figure>

<p>以上命令将7006节点接入7000所在的集群。接下来，我们为7006增加一个slave节点。  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-trib.rb add-node --slave 10.211.55.4:7007 10.211.55.4:7000</span><br></pre></td></tr></table></figure>
<p>以上命令表示增加slave节点，将7006的节点加入7000节点所在的集群中作为slave节点，随机依附现有的master节点中slave最少的节点，如果需要再指定特别的master节点，使用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-trib.rb add-node --slave --master-id 23b412673af0506df6382353e3a65960d5b7e66d 10.211.55.4:7007 10.211.55.4:7000</span><br></pre></td></tr></table></figure>
<p>其中的<code>23b412673af0506df6382353e3a65960d5b7e66d</code>是7006节点的id，我们可以通过<code>cluster nodes</code>命令查看节点的id。</p>
<p>接下来我们用坐负载均衡，Slot是Redis Cluster数据承载的最小单位，我们可以指定将一定范围的Slot转移到新的节点来实现负载均衡。</p>
<p>Redis Cluster转移一个Slot的步骤是:</p>
<ol>
<li>在目标节点上声明将从源节点上迁入Slot <code>CLUSTER SETSLOT &lt;slot&gt; IMPORTING &lt;source_node_id&gt;</code></li>
<li>在源节点上声明将往目标节点迁出Slot <code>CLUSTER SETSLOT &lt;slot&gt; IMPORTING &lt;source_node_id&gt;</code></li>
<li>批量从源节点获取KEY <code>CLUSTER GETKEYSINSLOT &lt;slot&gt; &lt;count&gt;</code></li>
<li>将获取的Key迁移到目标节点 <code>MIGRATE &lt;target_ip&gt; &lt;target_port&gt; &lt;key_name&gt; 0 &lt;timeout&gt;</code></li>
<li>重复步骤3，4直到所有数据迁移完毕</li>
<li>分别向双方节点发送 <code>CLUSTER SETSLOT &lt;slot&gt; NODE &lt;target_node_id&gt;</code>，该命令将会广播给集群其他节点，已经将Slot转移到目标节点。</li>
<li>等待集群状态变为OK <code>CLUSTER INFO</code> 中的 <code>cluster_state = ok</code></li>
</ol>
<p>我编写了一个脚本来批量迁移Slot</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">source_host=$1  # 源节点HOST</span><br><span class="line">source_port=$2  # 源节点端口</span><br><span class="line">target_host=$3  # 目标节点HOST</span><br><span class="line">target_port=$4  # 目标节点端口</span><br><span class="line">start_slot=$5   # 迁移节点的其实范围</span><br><span class="line">end_slot=$6     # 迁移节点的结束范围</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for slot in `seq $&#123;start_slot&#125; $&#123;end_slot&#125;`</span><br><span class="line">do</span><br><span class="line">	redis-cli -c -h $&#123;target_host&#125; -p $&#123;target_port&#125; cluster setslot $&#123;slot&#125; importing `redis-cli -c -h $&#123;source_host&#125; -p $&#123;source_port&#125; cluster nodes | grep $&#123;source_port&#125; | awk &#x27;&#123;print $1&#125;&#x27;`</span><br><span class="line">	echo &quot;Setslot importing $&#123;slot&#125; to $&#123;target_host&#125;:$&#123;target_port&#125; success&quot;</span><br><span class="line">	redis-cli -c -h $&#123;source_host&#125; -p $&#123;source_port&#125; cluster setslot $&#123;slot&#125; migrating `redis-cli -c -h $&#123;target_host&#125; -p $&#123;target_port&#125; cluster nodes | grep $&#123;target_port&#125; | awk &#x27;&#123;print $1&#125;&#x27;`</span><br><span class="line">	echo &quot;Setslot migrating $&#123;slot&#125; from $&#123;source_host&#125;:$&#123;source_port&#125; success&quot;</span><br><span class="line"></span><br><span class="line">	while [ 1 -eq 1 ]</span><br><span class="line">	do</span><br><span class="line">		allkeys=`redis-cli -c -h $&#123;source_host&#125; -p $&#123;source_port&#125; cluster getkeysinslot $&#123;slot&#125; 10`</span><br><span class="line">		if [ -z &quot;$&#123;allkeys&#125;&quot; ]</span><br><span class="line">		then</span><br><span class="line">			redis-cli -c -h $&#123;source_host&#125; -p $&#123;source_port&#125; cluster setslot $&#123;slot&#125; node `redis-cli -c -h $&#123;target_host&#125; -p $&#123;target_port&#125; cluster nodes | grep $&#123;target_port&#125; | awk &#x27;&#123;print $1&#125;&#x27;`</span><br><span class="line">			redis-cli -c -h $&#123;target_host&#125; -p $&#123;target_port&#125; cluster setslot $&#123;slot&#125; node `redis-cli -c -h $&#123;source_host&#125; -p $&#123;target_port&#125; cluster nodes | grep $&#123;target_port&#125; | awk &#x27;&#123;print $1&#125;&#x27;`</span><br><span class="line">			echo &quot;Migrate slot $&#123;slot&#125; finish&quot;</span><br><span class="line">			break</span><br><span class="line">		else </span><br><span class="line">			for key in $&#123;allkeys&#125;</span><br><span class="line">			do</span><br><span class="line">				redis-cli -c -h $&#123;source_host&#125; -p $&#123;source_port&#125; migrate $&#123;target_host&#125; $&#123;target_port&#125; $&#123;key&#125; 0 5000</span><br><span class="line">				echo &quot;Migrate slot $&#123;slot&#125; key $&#123;key&#125; success&quot;</span><br><span class="line">			done</span><br><span class="line">		fi</span><br><span class="line">	done</span><br><span class="line">done</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>执行命令 <code>bash rebalance-cluster.sh 10.211.55.4 7000 10.211.55.4 7006 0 1000</code> 将7000节点上0-1000这个范围内的Slot转移到7006节点，通过<code>cluster nodes</code>命令我们可以看到0-1000这个区间是slot已经从7000转移到7006</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xiezefan@ubuntu:~/sheel$ redis-cli -c -p 7000 cluster nodes</span><br><span class="line">23b412673af0506df6382353e3a65960d5b7e66d 10.211.55.4:7006 master - 0 1449064402389 7 connected 0-1000</span><br><span class="line">0c2954d21d7bcdae333f4fdecf468ce05aa25544 10.211.55.4:7001 master - 0 1449064400372 2 connected 5461-10922</span><br><span class="line">384a3bb5bd9ecb2fc7db75c866abc715d7966f82 10.211.55.4:7002 master - 0 1449064401381 3 connected 10923-16383</span><br><span class="line">c3e09d286ef2dce49843268b20832d65a5d516a1 10.211.55.4:7004 slave 0c2954d21d7bcdae333f4fdecf468ce05aa25544 0 1449064401885 5 connected</span><br><span class="line">50737b4a91443ab1a34eec4ef99d4f6fe5d358f4 10.211.55.4:7005 slave 384a3bb5bd9ecb2fc7db75c866abc715d7966f82 0 1449064402389 6 connected</span><br><span class="line">3c62cc6664bba378cceb8ae8e02f5d727deafe9d 10.211.55.4:7007 slave 23b412673af0506df6382353e3a65960d5b7e66d 0 1449064400878 7 connected</span><br><span class="line">d6441916dcd89cbf431465d92dfc0eb3dd235295 10.211.55.4:7003 slave 6ee21c5d93a6d2f293a2df1b37e8c9c27cb55ad8 0 1449064402389 4 connected</span><br><span class="line">6ee21c5d93a6d2f293a2df1b37e8c9c27cb55ad8 10.211.55.4:7000 myself,master - 0 0 1 connected 1001-5460</span><br></pre></td></tr></table></figure>


<h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><ul>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/dc_726/article/details/48552531">全面剖析Redis Cluster原理和应用</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/dc_726/article/details/43991905">Redis集群功能预览</a></li>
<li><a target="_blank" rel="noopener" href="http://carlosfu.iteye.com/blog/2243056">Redis-Cluster实战–8.Redis-Cluster水平扩容(redis-cli实现版)</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.codingnow.com/2014/03/mmzb_redis.html">谈谈陌陌争霸在数据库方面踩过的坑( Redis 篇)</a></li>
</ul>
</div><div class="tags"><a href="/tags/Redis"><i class="fa fa-tag">Redis</i></a></div><div class="post-nav"><a class="pre" href="/2015/12/13/redis_cluster_research_2/">Redis Cluster 初探(2) - 运行规制</a><a class="next" href="/2015/07/07/android-annotations-start/">Android 封装SDK时常用的注解</a></div><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/sukkaw/disqusjs/dist/disqusjs.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/sukkaw/disqusjs/dist/disqus.js"></script><script type="text/javascript" id="disqus-count-script">$(function() {
  var xhr = new XMLHttpRequest();
  xhr.open('GET', '//disqus.com/next/config.json', true);
  xhr.timeout = 2500;
  xhr.onreadystatechange = function () {
    if (xhr.readyState === 4 && xhr.status === 200) {
      $('.post-meta .post-comments-count').show();
      var s = document.createElement('script');
      s.id = 'dsq-count-scr';
      s.src = 'https://zefan-xies-blog.disqus.com/count.js';
      s.async = true;
      (document.head || document.body).appendChild(s);
    }
  };
  xhr.ontimeout = function () { xhr.abort(); };
  xhr.send(null);
});</script><div class="comments" id="disqus_thread"><script type="text/javascript">// Load comments with DisqusJS
function loadComments() {
  window.dsqjs = new DisqusJS({
    shortname: 'zefan-xies-blog',
    siteName: 'Zefan Xie\'s Blog',
    identifier: '2015/12/03/redis_cluster_research_1/',
    url: 'https://xiezefan.me/2015/12/03/redis_cluster_research_1/',
    title: 'Redis Cluster 初探(1) - 集群搭建与扩容',
    api: 'https://disqus.skk.moe/disqus/',
    apikey: 'spsas4a0SQQLhCsyIXPIXqQFp2vBKYLpl61lSjwrqMOW8a85hGORNyh1p5I4dLi9',
    admin: 'zefanxie',
    adminLabel: 'Mod'
  });
}
// Lazy load {# Credit: https://github.com/theme-next/hexo-theme-next/blob/master/layout/_third-party/comments/disqus.swig #}
(function () {
  var offsetTop = document.getElementById('disqus_thread').offsetTop - window.innerHeight;
  if (offsetTop <= 0) {
    // Load directly when there's no scrollbar
    window.addEventListener('load', loadComments, false);
  } else {
    var disqusScroll = function () {
      // offsetTop may changes because of manually resizing browser window or lazy loading images
      var offsetTop = document.getElementById('disqus_thread').offsetTop - window.innerHeight;
      var scrollTop = window.scrollY;

      // Pre-load comments a bit? (margin or anything else)
      if (offsetTop - scrollTop < 60) {
        window.removeEventListener('scroll', disqusScroll);
        loadComments();
      }
    };
    window.addEventListener('scroll', disqusScroll);
  }
})();
// Scroll to comments automatically if #comment-xxx anchor specified
window.addEventListener('load', function () {
  // I don't know why, it just works.
  window.setTimeout(function () {
    if (location.hash.indexOf('#comment-') !== -1) {
      document.getElementById('disqus_thread').scrollIntoView(true);
    }
  }, 100);
}, false);
</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://xiezefan.me"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/life/">Life</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/reading/">Reading</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/technical/">Technical</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/java/" style="font-size: 15px;">Java</a> <a href="/tags/agenda/" style="font-size: 15px;">Agenda</a> <a href="/tags/android/" style="font-size: 15px;">Android</a> <a href="/tags/druid/" style="font-size: 15px;">Druid</a> <a href="/tags/elk/" style="font-size: 15px;">ELK</a> <a href="/tags/gork/" style="font-size: 15px;">Gork</a> <a href="/tags/linux/" style="font-size: 15px;">Linux</a> <a href="/tags/maven/" style="font-size: 15px;">Maven</a> <a href="/tags/jdk/" style="font-size: 15px;">JDK</a> <a href="/tags/nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/keepalive/" style="font-size: 15px;">Keepalive</a> <a href="/tags/git/" style="font-size: 15px;">Git</a> <a href="/tags/mqtt/" style="font-size: 15px;">MQTT</a> <a href="/tags/im/" style="font-size: 15px;">IM</a> <a href="/tags/redis/" style="font-size: 15px;">Redis</a> <a href="/tags/mysql/" style="font-size: 15px;">Mysql</a> <a href="/tags/ziplist/" style="font-size: 15px;">Ziplist</a> <a href="/tags/sublime-text/" style="font-size: 15px;">Sublime-text</a> <a href="/tags/corporate-culture/" style="font-size: 15px;">Corporate Culture</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/06/19/netflix-no-rules-rules/">夜读 #1 -《不拘一格: 网飞的自由与责任工作法》</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/04/27/restart/">重启</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/06/druid_data_ingestion_different/">Druid 几种数据摄入方式的区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/27/nginx-502-bug-trace/">记一次生产环境Nginx间歇性502的事故分析过程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/01/redis_in_action_ziplist/">Redis内存压缩实战</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/09/elk_in_action_analyze_nginx_logs/">ELK实战 - 利用Nginx日志分析API耗时</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/09/elk_in_action_grok_start/">ELK实战 - Grok简易入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/13/maven_module_with_git_sub_module/">使用Git SubModule对Maven Module进行优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/13/redis_cluster_research_2/">Redis Cluster 初探(2) - 运行规制</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/03/redis_cluster_research_1/">Redis Cluster 初探(1) - 集群搭建与扩容</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//zefan-xies-blog.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022 <a href="/." rel="nofollow">Zefan Xie's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>